- name: Prep out machines for upgrade
  hosts: all
  gather_facts: false
  tasks:
    - name: Remove Extra Repos
      file:
        state: absent
        path: /etc/apt/sources.list.d
    - file:
        state: directory
        path: /etc/apt/sources.list.d

    - name: Reset sources.list to default
      copy:
        src: /root/upgrades/sources.list
        dest: /etc/apt/sources.list
        owner: root
        group: root
        mode: '0644'

    - name: Remove pip config from etc
      file:
        state: absent
        path: /etc/pip.conf

    - name: Remove pip config from root
      file:
        state: absent
        path: /root/.pip

    - name: Add trusted servers to pip
      copy:
        src: /root/upgrades/pip.conf
        dest: /etc/pip.conf
        owner: root
        group: root
        mode: '0644'
